---
title: "Case Study 2"
author: "Lizzy Sterling and Casey Martinez"
date: "12/06/2017"
output: rmarkdown::github_document
---
# Introduction 

## Key Questions  

```{r, echo=TRUE, include=FALSE}
if (!require(XML)) install.packages('XML')
library(XML)
library(rvest)
library(dplyr)
library(ggplot2)
library(ggthemes)
library(plyr)
library(knitr) #kable function
```

```{r, echo=TRUE}
knitr::opts_knit$set(root.dir = '/Users/lizzysterling/Desktop/CaseStudy2/Analysis/Data')
```
We are taking a look at the raw data frame.
```{r, echo=TRUE}
#2A
#setwd("Data")
Procrastination <- read.csv("Procrastination.csv", header=TRUE, stringsAsFactors=FALSE)
dim <- data.frame(nrow(Procrastination),ncol(Procrastination))
colnames(dim) <- c("Number of Rows", "Number of Columns")
kable(dim)
```  
  
  
In order to make the data set human-readable, we need to change the column names so that they make more sense. 
*You can reference the README.md file in the `Data` folder for further descriptions of these columns and columns 15 to 61 in particular*
```{r, echo=TRUE}
#2B
names(Procrastination) <- c("Age", "Gender", "Kids", "Education", "WorkStatus", "AnnualIncome", "Occupation", "OccupationYears", "OccupationMonths", "CommunitySize", "CountryOfResidence", "MaritalStatus", "NumberSons", "NumberDaughters", "DP1", "DP2", "DP3", "DP4", "DP5", "AIP1", "AIP2", "AIP3", "AIP4", "AIP5", "AIP6", "AIP7", "AIP8", "AIP9", "AIP10", "AIP11", "AIP12", "AIP13", "AIP14", "AIP15", "GP1", "GP2", "GP3", "GP4", "GP5", "GP6", "GP7", "GP8", "GP9", "GP10", "GP11", "GP12", "GP13", "GP14", "GP15", "GP16", "GP17", "GP18", "GP19", "GP20", "SWLS1", "SWLS2", "SWLS3", "SWLS4", "SWLS5", "P1", "P2")
```
Now that we know all of the column names, we need to check and make sure all of the values in the columns are accurate.  

We need to change the `Age` column so that they are in whole numbers. 
```{r, echo=TRUE}
#Procrastination$Age <- round(Procrastination$Age)
```
We also need to make the values of `OccupationYears` to integers so that we can determine which years do not makes sense.  
```{r, echo=TRUE}
#2C
Procrastination$OccupationYears <- round(Procrastination$OccupationYears)
OccupationYears <- data.frame(unique(Procrastination$OccupationYears))
colnames(OccupationYears) <- "OccupationYears"
kable(OccupationYears)
```
We are going to change all of the 999 entries to NAs, because this is likely a mistake.  
```{r, echo=TRUE}
Procrastination[grep("999", Procrastination$OccupationYears), "OccupationYears"] <- ""
```
In the `NumberSons` column, we need to check and see which values seem off.  
```{r, echo=TRUE}
NumberSons <- data.frame(unique(Procrastination$NumberSons))
colnames(NumberSons) <- "Number of Sons"
kable(NumberSons)
```  
  
  
We know that in this column, `Male`= 1 Son and `Female` = 2 Sons. Therefore, we need to change each Male and Female entry to their corresponding numbers.  
```{r, echo=TRUE}
Procrastination[grep("^Male.*", Procrastination$NumberSons),"NumberSons"] <- rep(1, length(Procrastination[grep("^Male.*", Procrastination$NumberSons),"NumberSons"]))

Procrastination[grep("^Female.*", Procrastination$NumberSons),"NumberSons"] <- rep(2, length(Procrastination[grep("^Female.*", Procrastination$NumberSons),"NumberSons"]))

```  
  
  
In our `CountryOfResidence` column, we only want values that are really countries. Because 0 is not a country of residence, we need to change it to a NA.  
```{r, echo=TRUE}
Procrastination[grep("0", Procrastination$CountryOfResidence), "CountryOfResidence"] <- ""
```
Looking at `Occupation`, we want to get rid of values that arent really jobs, as well as combine like-jobs together.  

First, we notice that `please specify` and `0` are not occupations, we can get rid of them.  
```{r, echo=TRUE}
Procrastination[grep("0", Procrastination$Occupation), "Occupation"] <- ""
Procrastination[grep("please specify", Procrastination$Occupation), "Occupation"] <- ""
```
Next, we need to group certain occupations together so that we can get accurate counts. We are going to do this to combine entries that include the word `Teacher` into a single group `Teachers` and entries that include `Computer` into one group `Computers` to include anyone who works with computers. 
```{r, echo=TRUE}
Procrastination[(grep("teacher", Procrastination$Occupation)), "Occupation"] <- "Teacher"
Procrastination[(grep("Computer", Procrastination$Occupation)), "Occupation"] <- "Computers"
```
Now that all of the columns are clean, we need to make sure they are of the correct data types.  
```{r, echo=TRUE}
kable(sapply(Procrastination, class), col.names="Class Type")
```  
  
  
There are certain columns that are not, so we are going to change them and then check again.  
```{r, echo=TRUE}
Procrastination$OccupationYears <- as.numeric(Procrastination$OccupationYears)
Procrastination$OccupationMonths <- as.numeric(Procrastination$OccupationMonths)
Procrastination$NumberSons <- as.numeric(Procrastination$NumberSons)
Procrastination$NumberDaughters <- as.numeric(Procrastination$NumberDaughters)
```

```{r, echo=TRUE}
Procrastination$DPmean <- rowMeans(Procrastination[15:19],na.rm = TRUE)
Procrastination$AIPmean <- rowMeans(Procrastination[20:34],na.rm = TRUE)
Procrastination$GPmean <- rowMeans(Procrastination[35:54],na.rm = TRUE)
Procrastination$SWLSmean <- rowMeans(Procrastination[55:59],na.rm = TRUE)
```

Now that we have the original data set `Procrastination.csv` cleaned, we are ready to add more data and conduct further analysis. 

Scraping the data into a table
```{r, echo=TRUE}
#3A
link = "https://en.wikipedia.org/wiki/List_of_countries_by_Human_Development_Index#Complete_list_of_countries"
doc <- read_html(link) 
node <- html_nodes(doc,"table")
tables <- html_table(node, fill = TRUE)
```

Creating a new data frame for each table of data
```{r, echo=TRUE}
df1 <- as.data.frame(tables[4]) #Very High Human Development1
df2 <- as.data.frame(tables[5]) #Very High Human Development2
df3 <- as.data.frame(tables[7]) #High Human Development1
df4 <- as.data.frame(tables[8]) #High Human Development2
df5 <- as.data.frame(tables[10]) #Medium Human Development1
df6 <- as.data.frame(tables[11]) #Medium Human Development2
df7 <- as.data.frame(tables[13]) #Low Human Development1
df8 <- as.data.frame(tables[14]) #Low Human Development2
```

Clean Up data frames and add category
```{r, echo=TRUE}
#3B
df1 <- df1[-1,3:4]
colnames(df1) <- c('Country','HDI')
df1$Category <- "Very High"

df2 <- df2[-1,3:4]
colnames(df2) <- c('Country','HDI')
df2$Category <- "Very High"

df3 <- df3[-1,3:4]
colnames(df3) <- c('Country','HDI')
df3$Category <- "High"

df4 <- df4[-1,3:4]
colnames(df4) <- c('Country','HDI')
df4$Category <- "High"

df5 <- df5[-1,3:4]
colnames(df5) <- c('Country','HDI')
df5$Category <- "Medium"

df6 <- df6[-1,3:4]
colnames(df6) <- c('Country','HDI')
df6$Category <- "Medium"

df7 <- df7[-1,3:4]
colnames(df7) <- c('Country','HDI')
df7$Category <- "Low"

df8 <- df8[-1,3:4]
colnames(df8) <- c('Country','HDI')
df8$Category <- "Low"
```
Now that we have the data we neeed, we can combine them together and create a new csv `HumanDevelopmentIndex.csv`
```{r, echo=TRUE}
df <- rbind(df1,df2,df3,df4,df5,df6,df7,df8)
write.csv(df, "HumanDevelopmentIndex.csv",row.names = FALSE)
```

```{r, echo=TRUE}
#3C
HDI <- read.csv("HumanDevelopmentIndex.csv", header=TRUE)
Pro <- merge(x = Procrastination,y = HDI, by.x = 'CountryOfResidence', by.y = "Country")
```

We only want to look at participants over 18, so we are going to remove all of the values in `Age` that are less than 18.
```{r, echo=TRUE}
#4A
ProAdult <- Pro[Pro$Age > 18,]
```

Now, we want a summary of the following columns, along with visualizations to better represent them. We need to find their summary statistics in matrix formation in order to output them into a proper table.
```{r, echo=TRUE}
#4B
row <- c("Minimum", "First Quartile", "Median", "Mean", "3rd Quartile", "Maximum", "NA's")

AgeSummary <- summary(ProAdult$Age)
IncomeSummary <- summary(ProAdult$AnnualIncome)
HDISummary <- summary(ProAdult$HDI)
DPSummary <- summary(ProAdult$DPmean)
GPSummary <- summary(ProAdult$GPmean)
AIPSummary <- summary(ProAdult$AIPmean)
SWLSSummary <- summary(ProAdult$SWLSmean)

kable(matrix(AgeSummary, dimnames = list(row,"Statistics for Age")), digits = 0, row.names=TRUE) 
kable(matrix(IncomeSummary, dimnames = list(row,"Statistics for Annual Income")), digits = 2, row.names=TRUE)
kable(matrix(HDISummary, dimnames = list(row,"Statistics for Human Development Index")), digits = 4, row.names=TRUE)
kable(matrix(DPSummary, dimnames = list(row,"Statistics for Decisional Procrastination")), digits = 4, row.names=TRUE)
kable(matrix(GPSummary, dimnames = list(row,"Statistics for Generalized Procastination")), digits = 4, row.names=TRUE)
kable(matrix(AIPSummary, dimnames = list(row,"Statistics for Adult Procrastination")), digits = 4, row.names=TRUE)
kable(matrix(SWLSSummary, dimnames = list(row,"Statistics for Satisfaction with Life Scale")), digits = 4, row.names=TRUE)

```
```{r, echo=TRUE}
#The histograms could definitely use some work -- we also need to choose variables that make sense
ggplot(ProAdult, aes(Age)) +
  geom_histogram() + 
  labs(x="\nAge",y="Frequency\n") + 
  ggtitle("Age of Procrastinators")

ggplot(ProAdult, aes(AnnualIncome)) +
  geom_histogram() + 
  labs(x="\nIncome",y="Frequency\n") + 
  ggtitle("Annual Income of Adult Procrastinators")


#With rounding
#  Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
#  19.00   28.00   38.00   38.38   45.00   80.00       6 

#w/o rounding 
#   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
#  19.00   28.00   37.50   38.36   45.00   80.00       6 
```

```{r, echo=TRUE}
#4C
GenderTable <- table(ProAdult$Gender)

WorkStatusTable <- table(ProAdult$WorkStatus)

OccupationTable <- table(ProAdult$Occupation)

#These don't look very pretty in the mark down file
ProAdult %>%  
  count_(GenderTable, sort=TRUE)

ProAdult %>%
  count_(WorkStatusTable, sort=TRUE)

ProAdult %>% 
  count_(OccupationTable, sort=TRUE)
```

```{r, echo=TRUE}
#4D
CountryTable <- table(ProAdult$CountryOfResidence)
ProAdult %>% 
  count_(CountryTable, sort=TRUE)
```

```{r, echo=TRUE}
#4e
A <- table(ProAdult$P1,ProAdult$P2)
A[-1,-1]
A[-1,-c(1,2,3)]
#could use some labels
```

```{r, echo=TRUE}
#Question 5B
#Why is the Dpmean scale in the ggplot so large? It should only be going up to 5
#head(sort(ProAdult$DPmean, decreasing=TRUE), n = 15)

ggplot(data = ProAdult, aes(x = CountryOfResidence, y = DPmean)) + 
  #geom_bar(stat="identity") + 
  geom_col(aes(CountryOfResidence, DPmean, fill = Category), stat="identity") +
  coord_flip() + 
  labs(y = 'Decisional Procrastination Scale', x = "Country of Residence", title = 'Top 15 Nations Average Procrastination Scores') +
  theme_economist() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r, echo=TRUE}
#Question 5c

```

```{r, echo=TRUE}
#Question 5d
ggplot(ProAdult, aes(Age, AnnualIncome)) + 
  geom_point(aes(fill=Gender),stat="identity")
```

```{r, echo=TRUE}
#5E
ggplot(ProAdult, aes(SWLSmean, HDI)) + 
  geom_point(aes(fill=Gender), stat="identity")
```
```{r, echo=TRUE}
ggplot(ProAdult, aes(SWLSmean, Category)) + 
  geom_point(aes(fill=Gender), stat="identity")
```
Combine 3A, 3B, 3C, 5B and 5C and output into a csv
```{r, echo=TRUE}

```
